
[Copy и Clone](https://github.com/rust-lang/rust/blob/2e6eaceedeeda764056eb0e2134735793533770d/src/libcore/marker.rs#L272) - это важные трейты в языке Rust, которые помогают управлять копированием и клонированием объектов.

---
## Copy

`Copy` - это трейт для типов, объекты которых можно копировать простым побитовым копированием (memcpy), без каких-либо дополнительных действий.

например при простом присваивании $y = x$ данные фактически копируются и получаются две независимые копии данных

Типы, которые реализуют `Copy` должны быть простыми в реализации.


Типы, которые поддерживают `Copy`:

- Все числовые типы, такие как `i32`, `u32`, `i64`, `u64`, `f32`, `f64` и так далее.
- `bool`.
- `char`.
- Кортежи, если все их элементы также реализуют `Copy`.
	- Например, кортеж `(i32, bool)` поддерживает `Copy`.
- Массивы, если тип элементов массива реализует `Copy`. 
	- Например, массив `[i32; 5]` поддерживает `Copy`.
- Функциональные типы: например `fn() -> i32`


$\triangle$ Тип может реализовывать `Copy`, если все его компоненты также реализуют `Copy`. 
- Например, структура `Point` с полями типа `i32` может быть `Copy`,
	потому что `i32` - это `Copy`.
	
Однако структура `PointList`, содержащая `Vec<Point>`, не может быть `Copy`, потому что `Vec<T>` не реализует `Copy`. 

При попытке сделать такую структуру `Copy`, компилятор выдаст ошибку.

---
## Clone

`Clone` - это трейт для не примитивных типов, объекты которых могут включать дополнительные действия, такие как выделение новой памяти.

Для клонирования объекта необходимо явно указать метод `.clone()` 

Пример для объекта нетривиального типа:
```Rust
let v: Vec<u8> = vec![1, 2, 3];
let w = v.clone();
``` 

=> `Clone` поддерживают любые типы, однако для некоторых нетривиальных типов реализация `Clone` представлена по умолчанию стандартной библиотекой:
- `String`
- `Vec<T>`
- `Option<T>`
- `Result<T>`
- Кортежи, массивы и перечисления,структуры элементы и поля которых не поддерживают `Copy`.
- `Box<T>`, если `T` не реализует `Copy`.
- `Rc<T>$, если $T$ не реализует $Copy$
- `Arc<T>`, если `T` не реализует `Copy`.
- ...

---
## #[derive(Copy, Clone)]

`#[derive(Copy, Clone)]` - это макрос в языке Rust, который предназначен для автоматической реализации трейтов Copy и Clone для пользовательских типов

```Rust
#[derive(Copy, Clone)]
struct Point {
    x: i32,
    y: i32,
}

fn main() {
    let p1 = Point { x: 10, y: 20 };
    let p2 = p1; // memcpy
    let p3 = p1.clone(); // explicit clone

    println!("p1: x = {}, y = {}", p1.x, p1.y);
    println!("p2: x = {}, y = {}", p2.x, p2.y);
    println!("p3: x = {}, y = {}", p3.x, p3.y);
}
```

=> Использование `#[derive(Copy, Clone)]` упрощает реализацию трейтов `Copy` и `Clone` для собственных типов, если все их поля уже реализуют эти трейты. 

Это позволяет использовать собственные типы в контекстах, где требуется копирование или клонирование, без дополнительных усилий.

---

## Special links with advanced information about these traits

1. [Implementation of Copy and Clone traits](https://github.com/rust-lang/rust/blob/2e6eaceedeeda764056eb0e2134735793533770d/src/libcore/clone.rs)
2. [Advanced](https://doc.rust-lang.org/std/clone/trait.Clone.html)